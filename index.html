<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>スケジュールアプリ</title>
    <style>
        body { font-family: Arial, sans-serif; }
        .navbar { background-color: #333; color: white; padding: 10px; display: flex; align-items: center; }
        .navbar button { font-size: 20px; color: white; background: none; border: none; cursor: pointer; margin-right: 10px; }
        .menu { display: none; flex-direction: column; background-color: white; padding: 10px; }
        .menu a { margin: 5px 0; text-decoration: none; color: blue; }
        .header { display: flex; justify-content: center; align-items: center; margin: 10px 0; }
        .schedule { overflow: auto; white-space: nowrap; }
        table { border-collapse: collapse; width: 100%; min-width: 600px; }
        th, td { border: 1px solid black; padding: 5px; text-align: center; }
        th.sticky, td.sticky { position: sticky; left: 0; background-color: white; z-index: 2; }
        th.top-left { z-index: 3; }
        .saturday { color: blue; }
        .sunday { color: red; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 20px; border-radius: 5px; }
        @media (max-width: 768px) {
            table { font-size: 12px; }
        }
    </style>
</head>
<body>

<div class="navbar">
    <button onclick="toggleMenu()">☰</button>
    <span>スケジュールアプリ</span>
</div>
<div class="menu" id="menu">
    <a href="#" onclick="showSchedule()">スケジュール表示</a>
    <a href="#" onclick="showSiteRegister()">現場登録</a>
    <a href="#">従業員・車両配置登録</a>
    <a href="#">従業員情報登録</a>
    <a href="#">車両情報登録</a>
</div>

<div id="content"></div>

<div class="modal" id="modal">
    <div class="modal-content" id="modalContent"></div>
</div>

<script>
    let currentView = 'schedule';
    let currentYear = 2025;
    let currentMonth = 6;
    let sites = [
        { id: 1, name: '菅峯橋架付', location: '本社', start: '2025-06-01', end: '2025-06-30' },
        { id: 2, name: '帯工事', location: '本社', start: '2025-06-01', end: '2025-06-30' }
    ];
    let selectedLocation = '本社';

    function toggleMenu() {
        const menu = document.getElementById('menu');
        menu.style.display = (menu.style.display === 'flex') ? 'none' : 'flex';
    }

    function showSchedule() {
        currentView = 'schedule';
        render();
        toggleMenu();
    }

    function showSiteRegister() {
        currentView = 'siteRegister';
        render();
        toggleMenu();
    }

    function showSiteDetail(index) {
        const site = sites[index];
        const modal = document.getElementById('modal');
        const modalContent = document.getElementById('modalContent');
        modalContent.innerHTML = `
            <h3>${site.name}</h3>
            <p>拠点: ${site.location}</p>
            <p>工期: ${site.start} ～ ${site.end}</p>
            <button onclick="editSite(${index})">編集</button>
            <button onclick="confirmDelete(${index})">削除</button>
            <button onclick="closeModal()">閉じる</button>
        `;
        modal.style.display = 'flex';
    }

    function editSite(index) {
        const site = sites[index];
        const modalContent = document.getElementById('modalContent');
        modalContent.innerHTML = `
            <h3>現場編集</h3>
            <label>現場名: <input id="editName" value="${site.name}"></label><br><br>
            <label>工期開始: <input type="date" id="editStart" value="${site.start}"></label><br><br>
            <label>工期終了: <input type="date" id="editEnd" value="${site.end}"></label><br><br>
            <button onclick="saveSite(${index})">保存</button>
            <button onclick="closeModal()">キャンセル</button>
        `;
    }

    function saveSite(index) {
        const name = document.getElementById('editName').value;
        const start = document.getElementById('editStart').value;
        const end = document.getElementById('editEnd').value;
        sites[index] = { ...sites[index], name, start, end };
        closeModal();
        render();
    }

    function confirmDelete(index) {
        const modalContent = document.getElementById('modalContent');
        modalContent.innerHTML += `
            <p>本当に削除しますか？</p>
            <button onclick="deleteSite(${index})">はい</button>
            <button onclick="closeModal()">いいえ</button>
        `;
    }

    function deleteSite(index) {
        sites.splice(index, 1);
        closeModal();
        render();
    }

    function closeModal() {
        document.getElementById('modal').style.display = 'none';
    }

    function render() {
        const content = document.getElementById('content');
        if (currentView === 'schedule') {
            let html = `
                <div class="header">
                    <label>拠点: 
                        <select onchange="changeLocation(this.value)">
                            <option ${selectedLocation === '本社' ? 'selected' : ''}>本社</option>
                            <option ${selectedLocation === '横浜' ? 'selected' : ''}>横浜</option>
                        </select>
                    </label>
                    <button onclick="changeMonth(-1)">前月</button>
                    <span>${currentYear}年${currentMonth}月</span>
                    <button onclick="changeMonth(1)">翌月</button>
                </div>
                <div class="schedule">
                    <table>
                        <tr>
                            <th class="sticky top-left">空き状況</th>`;

            const daysInMonth = new Date(currentYear, currentMonth, 0).getDate();
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(`${currentYear}-${String(currentMonth).padStart(2, '0')}-${String(day).padStart(2, '0')}`);
                const dayOfWeek = date.getDay();
                let className = '';
                if (dayOfWeek === 0) className = 'sunday';
                else if (dayOfWeek === 6) className = 'saturday';
                html += `<th class="${className}">${day}日<br>(${['日', '月', '火', '水', '木', '金', '土'][dayOfWeek]})</th>`;
            }

            html += `</tr><tr><td class="sticky">空き状況</td>`;
            for (let day = 1; day <= daysInMonth; day++) {
                html += `<td></td>`;
            }
            html += `</tr>`;

            sites.forEach((site, index) => {
                if (site.location === selectedLocation) {
                    html += `<tr><td class="sticky"><a href="#" onclick="showSiteDetail(${index})">${site.name}</a></td>`;
                    for (let day = 1; day <= daysInMonth; day++) {
                        const cellDate = `${currentYear}-${String(currentMonth).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                        if (cellDate >= site.start && cellDate <= site.end) {
                            html += `<td style="background: lightgray;"></td>`;
                        } else {
                            html += `<td></td>`;
                        }
                    }
                    html += `</tr>`;
                }
            });

            html += `</table></div>`;
            content.innerHTML = html;
        } else if (currentView === 'siteRegister') {
            content.innerHTML = `
                <div class="header">
                    <h2>現場登録</h2>
                </div>
                <div>
                    <label>現場名: <input id="siteName"></label><br><br>
                    <label>拠点: 
                        <select id="siteLocation">
                            <option>本社</option>
                            <option>横浜</option>
                        </select>
                    </label><br><br>
                    <label>工期開始: <input type="date" id="siteStart"></label><br><br>
                    <label>工期終了: <input type="date" id="siteEnd"></label><br><br>
                    <button onclick="registerSite()">登録</button>
                </div>
            `;
        }
    }

    function registerSite() {
        const name = document.getElementById('siteName').value;
        const location = document.getElementById('siteLocation').value;
        const start = document.getElementById('siteStart').value;
        const end = document.getElementById('siteEnd').value;
        if (name && start && end) {
            sites.push({ id: sites.length + 1, name, location, start, end });
            showSchedule();
        } else {
            alert('全て入力してください');
        }
    }

    function changeLocation(location) {
        selectedLocation = location;
        render();
    }

    function changeMonth(offset) {
        currentMonth += offset;
        if (currentMonth < 1) {
            currentMonth = 12;
            currentYear -= 1;
        } else if (currentMonth > 12) {
            currentMonth = 1;
            currentYear += 1;
        }
        render();
    }

    render();
</script>

</body>
</html>
