<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>スケジュールアプリ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; }
        .menu { background-color: #333; color: white; padding: 10px; display: flex; align-items: center; }
        .menu-icon { cursor: pointer; margin-right: 10px; }
        .menu-links { display: none; flex-direction: column; background-color: #333; padding: 10px; }
        .menu-links a { color: white; text-decoration: none; margin: 5px 0; }
        .header { display: flex; justify-content: space-between; align-items: center; padding: 10px; }
        table { border-collapse: collapse; width: max-content; min-width: 100%; }
        th, td { border: 1px solid #000; padding: 5px; text-align: center; min-width: 80px; }
        .label-column { background-color: #f2f2f2; position: sticky; left: 0; z-index: 2; }
        .fixed-cell { background-color: #f2f2f2; position: sticky; top: 0; left: 0; z-index: 3; }
        .header-cell { background-color: #f2f2f2; position: sticky; top: 0; z-index: 2; }
        .saturday { color: blue; }
        .sunday { color: red; }
        .scroll-container { overflow: auto; max-height: 80vh; }
        .site-link { cursor: pointer; color: blue; text-decoration: underline; }
    </style>
</head>
<body>
    <div class="menu">
        <span class="menu-icon" onclick="toggleMenu()">≡</span>
        <span>スケジュールアプリ</span>
    </div>
    <div class="menu-links" id="menuLinks">
        <a href="#" onclick="changeView('schedule')">スケジュール表示</a>
        <a href="#" onclick="changeView('register')">現場登録</a>
        <a href="#" onclick="alert('従業員・車両配置登録（未実装）')">従業員・車両配置登録</a>
        <a href="#" onclick="alert('従業員情報登録（未実装）')">従業員情報登録</a>
        <a href="#" onclick="alert('車両情報登録（未実装）')">車両情報登録</a>
    </div>

    <div class="header">
        <div>
            拠点：
            <select id="locationSelect" onchange="renderSchedule()">
                <option value="本社">本社</option>
                <option value="横浜">横浜</option>
            </select>
        </div>
        <div>
            <button onclick="changeMonth(-1)">前月</button>
            <span id="currentMonth"></span>
            <button onclick="changeMonth(1)">翌月</button>
        </div>
    </div>

    <div id="content"></div>

    <script>
        let year = 2025;
        let month = 6;
        let currentView = 'schedule';

        let sites = [
            { id: 1, name: '菅峯橋架付', location: '本社', start: '2025-06-01', end: '2025-06-30' },
            { id: 2, name: '帯工事', location: '本社', start: '2025-06-01', end: '2025-06-30' }
        ];

        function toggleMenu() {
            const menu = document.getElementById('menuLinks');
            menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
        }

        function changeMonth(diff) {
            month += diff;
            if (month < 1) { month = 12; year--; }
            if (month > 12) { month = 1; year++; }
            renderView();
        }

        function changeView(view) {
            currentView = view;
            document.getElementById('menuLinks').style.display = 'none';
            renderView();
        }

        function renderView() {
            if (currentView === 'schedule') {
                renderSchedule();
            } else if (currentView === 'register') {
                renderRegister();
            }
        }

        function renderSchedule() {
            const location = document.getElementById('locationSelect').value;
            const daysInMonth = new Date(year, month, 0).getDate();
            const content = document.getElementById('content');
            document.getElementById('currentMonth').innerText = `${year}年${month}月`;

            let html = '<div class="scroll-container"><table><tr>';
            html += '<th class="fixed-cell">空き状況</th>';

            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month - 1, day);
                const dayOfWeek = date.getDay();
                let className = '';
                if (dayOfWeek === 0) className = 'sunday';
                if (dayOfWeek === 6) className = 'saturday';
                html += `<th class="header-cell ${className}">${day}日<br>(${['日', '月', '火', '水', '木', '金', '土'][dayOfWeek]})</th>`;
            }
            html += '</tr>';

            html += '<tr><td class="label-column">空き状況</td>';
            for (let day = 1; day <= daysInMonth; day++) { html += '<td></td>'; }
            html += '</tr>';

            sites.filter(s => s.location === location).forEach(site => {
                html += `<tr><td class="label-column"><span class="site-link" onclick="viewSite(${site.id})">${site.name}</span></td>`;
                for (let day = 1; day <= daysInMonth; day++) {
                    const dateStr = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    const isOutOfPeriod = dateStr < site.start || dateStr > site.end;
                    html += `<td style="background-color:${isOutOfPeriod ? '#ccc' : '#fff'}"></td>`;
                }
                html += '</tr>';
            });

            html += '</table></div>';
            content.innerHTML = html;
        }

        function renderRegister() {
            const content = document.getElementById('content');
            content.innerHTML = `
                <h2>現場登録</h2>
                <form onsubmit="addSite(event)">
                    現場名: <input type="text" id="siteName" required><br>
                    拠点: 
                    <select id="siteLocation">
                        <option value="本社">本社</option>
                        <option value="横浜">横浜</option>
                    </select><br>
                    工期開始: <input type="date" id="startDate" required><br>
                    工期終了: <input type="date" id="endDate" required><br>
                    <button type="submit">登録</button>
                </form>
            `;
        }

        function addSite(event) {
            event.preventDefault();
            const name = document.getElementById('siteName').value;
            const location = document.getElementById('siteLocation').value;
            const start = document.getElementById('startDate').value;
            const end = document.getElementById('endDate').value;

            sites.push({ id: Date.now(), name, location, start, end });
            alert('現場を登録しました');
            renderView();
        }

        function viewSite(id) {
            const site = sites.find(s => s.id === id);
            const content = document.getElementById('content');
            content.innerHTML = `
                <h2>現場情報</h2>
                <p>現場名: ${site.name}</p>
                <p>拠点: ${site.location}</p>
                <p>工期: ${site.start} ～ ${site.end}</p>
                <button onclick="editSite(${id})">編集</button>
                <button onclick="deleteSite(${id})">削除</button>
                <button onclick="renderView()">戻る</button>
            `;
        }

        function editSite(id) {
            const site = sites.find(s => s.id === id);
            const content = document.getElementById('content');
            content.innerHTML = `
                <h2>現場編集</h2>
                <form onsubmit="updateSite(event, ${id})">
                    現場名: <input type="text" id="editSiteName" value="${site.name}" required><br>
                    拠点: 
                    <select id="editSiteLocation">
                        <option value="本社" ${site.location === '本社' ? 'selected' : ''}>本社</option>
                        <option value="横浜" ${site.location === '横浜' ? 'selected' : ''}>横浜</option>
                    </select><br>
                    工期開始: <input type="date" id="editStartDate" value="${site.start}" required><br>
                    工期終了: <input type="date" id="editEndDate" value="${site.end}" required><br>
                    <button type="submit">更新</button>
                    <button type="button" onclick="renderView()">キャンセル</button>
                </form>
            `;
        }

        function updateSite(event, id) {
            event.preventDefault();
            const site = sites.find(s => s.id === id);
            site.name = document.getElementById('editSiteName').value;
            site.location = document.getElementById('editSiteLocation').value;
            site.start = document.getElementById('editStartDate').value;
            site.end = document.getElementById('editEndDate').value;
            alert('現場情報を更新しました');
            renderView();
        }

        function deleteSite(id) {
            if (confirm('本当に削除しますか？')) {
                sites = sites.filter(s => s.id !== id);
                alert('削除しました');
                renderView();
            }
        }

        renderSchedule();
    </script>
</body>
</html>
