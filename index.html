<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>スケジュールアプリ</title>
  <style>
    /* 省略せず全CSS再送可（必要なら言ってね） */
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
    .menu {
      display: flex;
      align-items: center;
      background: #333;
      color: white;
      padding: 10px;
    }
    .menu-button {
      font-size: 24px;
      cursor: pointer;
      margin-right: 10px;
    }
    .menu-items {
      display: none;
      background: #eee;
      padding: 10px;
    }
    .menu-items a {
      display: block;
      margin: 5px 0;
      cursor: pointer;
    }
    .header {
      display: flex;
      align-items: center;
      padding: 10px;
    }
    .table-container {
      width: 100%;
      height: calc(100vh - 150px);
      overflow: auto;
      position: relative;
    }
    table {
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #999;
      min-width: 80px;
      height: 40px;
      text-align: center;
    }
    .fixed-cell {
      position: sticky;
      background: white;
      z-index: 3;
    }
    .fixed-top-left {
      top: 0;
      left: 0;
      z-index: 5;
    }
    .fixed-top {
      top: 0;
      z-index: 4;
    }
    .fixed-left {
      left: 0;
      z-index: 4;
    }
    .saturday {
      color: blue;
    }
    .sunday {
      color: red;
    }
  </style>
</head>
<body>
  <div class="menu">
    <span class="menu-button" onclick="toggleMenu()">☰</span>
    <span>スケジュールアプリ</span>
  </div>
  <div id="menuItems" class="menu-items">
    <a onclick="showSchedule()">スケジュール表示</a>
    <a onclick="showSiteRegister()">現場登録</a>
    <a>従業員・車両配置登録</a>
    <a>従業員情報登録</a>
    <a>車両情報登録</a>
  </div>

  <div class="header">
    <label>拠点：</label>
    <select id="locationSelect" onchange="renderTable()">
      <option value="本社">本社</option>
      <option value="横浜">横浜</option>
    </select>

    <button onclick="prevMonth()">前月</button>
    <span id="currentMonth"></span>
    <button onclick="nextMonth()">翌月</button>
  </div>

  <div class="table-container" id="tableContainer"></div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script>
    // Firebase設定
    var firebaseConfig = {
      apiKey: "AIzaSyAdX0gQ9pyySwsXzS3Snj7Rivz420tEpxU",
      authDomain: "schedule-app-faf39.firebaseapp.com",
      databaseURL: "https://schedule-app-faf39-default-rtdb.firebaseio.com",
      projectId: "schedule-app-faf39",
      storageBucket: "schedule-app-faf39.appspot.com",
      messagingSenderId: "56363342875",
      appId: "1:56363342875:web:585c9a2a1f9874a58785e"
    };
    firebase.initializeApp(firebaseConfig);
    var database = firebase.database();
  </script>

  <script>
    let year = 2025;
    let month = 6;
    let sites = [];

    function toggleMenu() {
      const menu = document.getElementById('menuItems');
      menu.style.display = (menu.style.display === 'block') ? 'none' : 'block';
    }

    function prevMonth() {
      month--;
      if (month === 0) {
        month = 12;
        year--;
      }
      renderTable();
    }

    function nextMonth() {
      month++;
      if (month === 13) {
        month = 1;
        year++;
      }
      renderTable();
    }

    function getDaysInMonth(year, month) {
      return new Date(year, month, 0).getDate();
    }

    function fetchSites(callback) {
      const location = document.getElementById('locationSelect').value;
      firebase.database().ref('sites').orderByChild('location').equalTo(location).once('value', (snapshot) => {
        sites = [];
        snapshot.forEach((child) => {
          sites.push(child.val().name);
        });
        callback();
      });
    }

    function renderTable() {
      document.getElementById('currentMonth').innerText = `${year}年${month}月`;
      fetchSites(() => {
        const days = getDaysInMonth(year, month);
        const container = document.getElementById('tableContainer');
        let html = '<table><thead><tr><th class="fixed-cell fixed-top-left"></th>';

        for (let d = 1; d <= days; d++) {
          const date = new Date(year, month - 1, d);
          const day = date.getDay();
          const className = day === 0 ? 'sunday' : (day === 6 ? 'saturday' : '');
          html += `<th class="fixed-cell fixed-top ${className}">${d}日(${['日', '月', '火', '水', '木', '金', '土'][day]})</th>`;
        }
        html += '</tr></thead><tbody>';

        sites.forEach(site => {
          html += `<tr><th class="fixed-cell fixed-left">${site}</th>`;
          for (let d = 1; d <= days; d++) {
            html += `<td></td>`;
          }
          html += '</tr>';
        });

        html += '</tbody></table>';
        container.innerHTML = html;
      });
    }

    function showSchedule() {
      renderTable();
      document.getElementById('menuItems').style.display = 'none';
    }

    function showSiteRegister() {
      location.href = 'site_register.html';
    }

    // 初期表示
    renderTable();
  </script>
</body>
</html>
