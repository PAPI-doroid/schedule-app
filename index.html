<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>スケジュールアプリ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
        .menu { background-color: #333; color: white; padding: 10px; display: flex; align-items: center; }
        .menu-icon { cursor: pointer; margin-right: 10px; }
        .menu-content { display: none; background-color: #f9f9f9; padding: 10px; position: absolute; z-index: 10; }
        .menu-content a { display: block; margin: 5px 0; }
        .header { display: flex; align-items: center; padding: 10px; }
        table { border-collapse: collapse; width: 100%; table-layout: fixed; }
        th, td { border: 1px solid #000; text-align: center; min-width: 80px; word-wrap: break-word; }
        th.fixed, td.fixed { position: sticky; left: 0; background: #f1f1f1; z-index: 2; }
        th.fixed-top { position: sticky; top: 0; background: #f1f1f1; z-index: 3; }
        .saturday { color: blue; }
        .sunday { color: red; }
        .site-name { color: blue; cursor: pointer; text-decoration: underline; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 20px; border-radius: 5px; width: 300px; }
        .scroll-container { overflow: auto; max-height: 500px; }
        .month-control { text-align: center; margin: 10px 0; }
    </style>
</head>
<body>

<div class="menu">
    <div class="menu-icon" onclick="toggleMenu()">☰</div>
    <div>スケジュールアプリ</div>
</div>
<div class="menu-content" id="menuContent">
    <a href="#" onclick="showSchedule()">スケジュール表示</a>
    <a href="#" onclick="showSiteRegister()">現場登録</a>
    <a href="#">従業員・車両配置登録</a>
    <a href="#">従業員情報登録</a>
    <a href="#">車両情報登録</a>
</div>

<div class="month-control">
    <button onclick="changeMonth(-1)">前月</button>
    <span id="currentMonth"></span>
    <button onclick="changeMonth(1)">翌月</button>
</div>

<div class="header">
    <label>拠点：
        <select id="locationSelect" onchange="renderTable()">
            <option value="本社">本社</option>
            <option value="横浜">横浜</option>
        </select>
    </label>
</div>

<div id="siteRegister" style="display:none; padding:10px;">
    <h3>現場登録</h3>
    <label>現場名：<input type="text" id="siteName"></label><br><br>
    <label>拠点：
        <select id="siteLocation">
            <option value="本社">本社</option>
            <option value="横浜">横浜</option>
        </select>
    </label><br><br>
    <label>工期開始：<input type="date" id="startDate"></label><br><br>
    <label>工期終了：<input type="date" id="endDate"></label><br><br>
    <button onclick="registerSite()">登録</button>
</div>

<div id="scheduleScreen" class="scroll-container"></div>

<div class="modal" id="siteModal">
    <div class="modal-content">
        <h4 id="modalSiteName"></h4>
        <button onclick="editSite()">編集</button>
        <button onclick="confirmDelete()">削除</button>
        <button onclick="closeModal()">閉じる</button>
        <div id="editFields" style="display:none;">
            <label>工期開始：<input type="date" id="editStartDate"></label><br><br>
            <label>工期終了：<input type="date" id="editEndDate"></label><br><br>
            <button onclick="saveEdit()">保存</button>
        </div>
        <div id="deleteConfirm" style="display:none;">
            <p>本当に削除しますか？</p>
            <button onclick="deleteSite()">はい</button>
            <button onclick="cancelDelete()">いいえ</button>
        </div>
    </div>
</div>

<script>
let currentYear = 2025;
let currentMonth = 6;
let sites = JSON.parse(localStorage.getItem('sites')) || [];
let selectedSite = null;

function toggleMenu() {
    const menu = document.getElementById('menuContent');
    menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
}

function showSchedule() {
    document.getElementById('scheduleScreen').style.display = 'block';
    document.getElementById('siteRegister').style.display = 'none';
    document.getElementById('menuContent').style.display = 'none';
    renderTable();
}

function showSiteRegister() {
    document.getElementById('scheduleScreen').style.display = 'none';
    document.getElementById('siteRegister').style.display = 'block';
    document.getElementById('menuContent').style.display = 'none';
}

function changeMonth(change) {
    currentMonth += change;
    if (currentMonth === 0) { currentMonth = 12; currentYear--; }
    if (currentMonth === 13) { currentMonth = 1; currentYear++; }
    renderTable();
}

function getDaysInMonth(year, month) {
    return new Date(year, month, 0).getDate();
}

function registerSite() {
    const name = document.getElementById('siteName').value;
    const location = document.getElementById('siteLocation').value;
    const startDate = document.getElementById('startDate').value;
    const endDate = document.getElementById('endDate').value;

    if (name && startDate && endDate) {
        sites.push({ name, location, startDate, endDate });
        localStorage.setItem('sites', JSON.stringify(sites));
        document.getElementById('siteName').value = '';
        document.getElementById('startDate').value = '';
        document.getElementById('endDate').value = '';
        renderTable();
        showSchedule();
    }
}

function renderTable() {
    const scheduleScreen = document.getElementById('scheduleScreen');
    const location = document.getElementById('locationSelect').value;
    const daysInMonth = getDaysInMonth(currentYear, currentMonth);
    const weekdays = ['日', '月', '火', '水', '木', '金', '土'];

    document.getElementById('currentMonth').innerText = `${currentYear}年${currentMonth}月`;

    let table = '<table><thead><tr><th class="fixed fixed-top"></th>';
    for (let day = 1; day <= daysInMonth; day++) {
        const date = new Date(currentYear, currentMonth - 1, day);
        const weekday = weekdays[date.getDay()];
        const colorClass = weekday === '土' ? 'saturday' : weekday === '日' ? 'sunday' : '';
        table += `<th class="fixed-top ${colorClass}">${day}日<br>(${weekday})</th>`;
    }
    table += '</tr></thead><tbody>';
    table += '<tr><td class="fixed">空き状況</td>';
    for (let i = 1; i <= daysInMonth; i++) { table += '<td></td>'; }
    table += '</tr>';

    sites.filter(site => site.location === location).forEach(site => {
        table += `<tr><td class="fixed"><span class="site-name" onclick="openModal('${site.name}')">${site.name}</span></td>`;
        for (let i = 1; i <= daysInMonth; i++) {
            const cellDate = new Date(currentYear, currentMonth - 1, i).toISOString().split('T')[0];
            if (cellDate >= site.startDate && cellDate <= site.endDate) {
                table += '<td style="background-color: #ddd;"></td>';
            } else {
                table += '<td></td>';
            }
        }
        table += '</tr>';
    });

    table += '</tbody></table>';
    scheduleScreen.innerHTML = table;
}

function openModal(name) {
    selectedSite = sites.find(site => site.name === name);
    document.getElementById('modalSiteName').innerText = selectedSite.name;
    document.getElementById('editFields').style.display = 'none';
    document.getElementById('deleteConfirm').style.display = 'none';
    document.getElementById('siteModal').style.display = 'flex';
}

function closeModal() {
    document.getElementById('siteModal').style.display = 'none';
}

function editSite() {
    document.getElementById('editStartDate').value = selectedSite.startDate;
    document.getElementById('editEndDate').value = selectedSite.endDate;
    document.getElementById('editFields').style.display = 'block';
    document.getElementById('deleteConfirm').style.display = 'none';
}

function saveEdit() {
    selectedSite.startDate = document.getElementById('editStartDate').value;
    selectedSite.endDate = document.getElementById('editEndDate').value;
    localStorage.setItem('sites', JSON.stringify(sites));
    renderTable();
    closeModal();
}

function confirmDelete() {
    document.getElementById('deleteConfirm').style.display = 'block';
    document.getElementById('editFields').style.display = 'none';
}

function deleteSite() {
    sites = sites.filter(site => site !== selectedSite);
    localStorage.setItem('sites', JSON.stringify(sites));
    renderTable();
    closeModal();
}

function cancelDelete() {
    document.getElementById('deleteConfirm').style.display = 'none';
}

window.onload = () => { renderTable(); };
</script>

</body>
</html>
